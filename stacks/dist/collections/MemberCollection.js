"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MemberCollection = exports.NoOpMemberCollection = void 0;
const Member_1 = require("../Member");
const Model_1 = require("../Model");
class NoOpMemberCollection {
    constructor() {
        this.model = Model_1.Model.NoOp;
    }
    add(name, value) {
        throw new Error("Method not implemented.");
    }
    append(obj) {
        throw new Error("Method not implemented.");
    }
    delete(name) {
        throw new Error("Method not implemented.");
    }
    find(predicate) {
        throw new Error("Method not implemented.");
    }
    map(visit) {
        throw new Error("Method not implemented.");
    }
    get(name) {
        throw new Error("Method not implemented.");
    }
    [Symbol.iterator]() {
        throw new Error("Method not implemented.");
    }
}
exports.NoOpMemberCollection = NoOpMemberCollection;
class MemberCollection {
    constructor(model, context) {
        this.model = model;
        this.context = context;
        this.members = new Array();
    }
    get uid() {
        return this.context.uid;
    }
    [Symbol.iterator]() {
        let index = 0;
        let self = this;
        return {
            next() {
                return index == self.members.length ?
                    { value: undefined, done: true } :
                    { value: self.members[index++], done: false };
            }
        };
    }
    async add(name, value) {
        let found = this.members.find(m => m.name === name);
        let member = Member_1.Member.create({ [name]: value }, this.model, { model: this.model }, this.context);
        if (found !== undefined) {
            found.value = member[0].value;
            return;
        }
        this.members.push(...member);
    }
    async append(obj) {
        let members = Member_1.Member.create(obj, this.model, { model: this.model }, this.context);
        for (let member of members) {
            let found = this.members.find(m => m.name === member.name);
            // Replace an existing Member if the Types match
            if (found !== undefined) {
                found.value = member.value;
                continue;
            }
            this.members.push(member);
        }
    }
    async delete(name) {
        let found = this.members.findIndex(m => m.name === name);
        if (found) {
            this.members.splice(found, 1);
        }
    }
    find(predicate) {
        return this.members.find(predicate);
    }
    map(visit) {
        return this.members.map(visit);
    }
    get(name) {
        return this.members.find(m => m.name === name);
    }
}
exports.MemberCollection = MemberCollection;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVtYmVyQ29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb2xsZWN0aW9ucy9NZW1iZXJDb2xsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHNDQUF5RDtBQUN6RCxvQ0FBMkQ7QUF5QjNELE1BQWEsb0JBQW9CO0lBRzlCO1FBQ0csSUFBSSxDQUFDLEtBQUssR0FBRyxhQUFLLENBQUMsSUFBSSxDQUFBO0lBQzFCLENBQUM7SUFFRCxHQUFHLENBQUMsSUFBWSxFQUFFLEtBQWtCO1FBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBQ0QsTUFBTSxDQUFDLEdBQXNCO1FBQzFCLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBQ0QsTUFBTSxDQUFDLElBQVk7UUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDRCxJQUFJLENBQUMsU0FBb0M7UUFDdEMsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDRCxHQUFHLENBQUksS0FBK0I7UUFDbkMsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDRCxHQUFHLENBQUMsSUFBWTtRQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBQ0QsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7Q0FFSDtBQTdCRCxvREE2QkM7QUFFRCxNQUFhLGdCQUFnQjtJQVUxQixZQUFZLEtBQWEsRUFBRSxPQUFzQjtRQUM5QyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtRQUNsQixJQUFJLENBQUMs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Q0FBSSxLQUErQjtRQUNuQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ2pDLENBQUM7SUFFRCxHQUFHLENBQUMsSUFBWTtRQUNiLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFBO0lBQ2pELENBQUM7Q0FDSDtBQTVFRCw0Q0E0RUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJTWVtYmVyLCBNZW1iZXIsIE1lbWJlclZhbHVlIH0gZnJvbSBcIi4uL01lbWJlclwiO1xuaW1wb3J0IHsgSU1vZGVsLCBNb2RlbCwgTW9kZWxDcmVhdGVQYXJhbXMgfSBmcm9tICcuLi9Nb2RlbCdcbmltcG9ydCB7IElTdGFja0NvbnRleHQgfSBmcm9tIFwiLi4vc3RhY2svU3RhY2tDb250ZXh0XCI7XG5pbXBvcnQgeyBJVWlkS2VlcGVyIH0gZnJvbSBcIi4uL1VpZEtlZXBlclwiO1xuaW1wb3J0IHsgUHJlZGljYXRlSGFuZGxlciwgVmlzaXRIYW5kbGVyIH0gZnJvbSBcIi4vSGFuZGxlcnNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJTWVtYmVyQ29sbGVjdGlvbiB7XG4gICByZWFkb25seSBtb2RlbDogSU1vZGVsXG5cbiAgIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhdG9yPElNZW1iZXI+XG5cbiAgIGFkZChuYW1lOiBzdHJpbmcsIHZhbHVlOiBNZW1iZXJWYWx1ZSk6IFByb21pc2U8dm9pZD5cbiAgIGFwcGVuZChvYmo6IE1vZGVsQ3JlYXRlUGFyYW1zKTogUHJvbWlzZTx2b2lkPlxuICAgZGVsZXRlKG5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD5cbiAgIGZpbmQocHJlZGljYXRlOiBQcmVkaWNhdGVIYW5kbGVyPElNZW1iZXI+KTogSU1lbWJlciB8IHVuZGVmaW5lZFxuXG4gICAvKipcbiAgICAqIE1hcHMgdGhlIE1lbWJlcnMgaW50byBhbm90aGVyIHN0cnVjdHVyZVxuICAgICogXG4gICAgKiBAcGFyYW0gdmlzaXQgSGFuZGxlciB1c2VkIHRvIHRyYW5zZm9ybSBlYWNoIEZpZWxkXG4gICAgKi9cbiAgIG1hcDxUPih2aXNpdDogVmlzaXRIYW5kbGVyPElNZW1iZXIsIFQ+KTogVFtdXG5cbiAgIGdldChuYW1lOiBzdHJpbmcpOiBJTWVtYmVyIHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjbGFzcyBOb09wTWVtYmVyQ29sbGVjdGlvbiBpbXBsZW1lbnRzIElNZW1iZXJDb2xsZWN0aW9uIHtcbiAgIG1vZGVsOiBJTW9kZWw7XG5cbiAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgdGhpcy5tb2RlbCA9IE1vZGVsLk5vT3BcbiAgIH1cbiAgIFxuICAgYWRkKG5hbWU6IHN0cmluZywgdmFsdWU6IE1lbWJlclZhbHVlKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgIH1cbiAgIGFwcGVuZChvYmo6IE1vZGVsQ3JlYXRlUGFyYW1zKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgIH1cbiAgIGRlbGV0ZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgfVxuICAgZmluZChwcmVkaWNhdGU6IFByZWRpY2F0ZUhhbmRsZXI8SU1lbWJlcj4pOiBJTWVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgfVxuICAgbWFwPFQ+KHZpc2l0OiBWaXNpdEhhbmRsZXI8SU1lbWJlciwgVD4pOiBUW10ge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICB9XG4gICBnZXQobmFtZTogc3RyaW5nKTogSU1lbWJlciB8IHVuZGVmaW5lZCB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgIH1cbiAgIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhdG9yPElNZW1iZXIsIGFueSwgdW5kZWZpbmVkPiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgIH1cbiAgIFxufVxuXG5leHBvcnQgY2xhc3MgTWVtYmVyQ29sbGVjdGlvbiBpbXBsZW1lbnRzIElNZW1iZXJDb2xsZWN0aW9uIHtcbiAgIHJlYWRvbmx5IG1vZGVsOiBJTW9kZWxcbiAgIHJlYWRvbmx5IGNvbnRleHQ6IElTdGFja0NvbnRleHRcblxuICAgZ2V0IHVpZCgpOiBJVWlkS2VlcGVyIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnRleHQudWlkXG4gICB9XG5cbiAgIHByaXZhdGUgbWVtYmVyczogQXJyYXk8SU1lbWJlcj5cblxuICAgY29uc3RydWN0b3IobW9kZWw6IElNb2RlbCwgY29udGV4dDogSVN0YWNrQ29udGV4dCkge1xuICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsXG4gICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0XG4gICAgICB0aGlzLm1lbWJlcnMgPSBuZXcgQXJyYXk8SU1lbWJlcj4oKVxuICAgfVxuXG4gICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxJTWVtYmVyPiB7XG4gICAgICBsZXQgaW5kZXggPSAwXG4gICAgICBsZXQgc2VsZiA9IHRoaXNcbiAgICAgIHJldHVybiB7XG4gICAgICAgICBuZXh0KCk6IEl0ZXJhdG9yUmVzdWx0PElNZW1iZXI+IHtcbiAgICAgICAgICAgIHJldHVybiBpbmRleCA9PSBzZWxmLm1lbWJlcnMubGVuZ3RoID9cbiAgICAgICAgICAgICAgIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9IDpcbiAgICAgICAgICAgICAgIHsgdmFsdWU6IHNlbGYubWVtYmVyc1tpbmRleCsrXSwgZG9uZTogZmFsc2UgfVxuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuXG4gICBhc3luYyBhZGQobmFtZTogc3RyaW5nLCB2YWx1ZTogTWVtYmVyVmFsdWUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIGxldCBmb3VuZCA9IHRoaXMubWVtYmVycy5maW5kKG0gPT4gbS5uYW1lID09PSBuYW1lKVxuXG4gICAgICBsZXQgbWVtYmVyID0gTWVtYmVyLmNyZWF0ZSh7IFtuYW1lXTogdmFsdWUgfSwgdGhpcy5tb2RlbCwgeyBtb2RlbDogdGhpcy5tb2RlbCB9LCB0aGlzLmNvbnRleHQpXG5cbiAgICAgIGlmIChmb3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICBmb3VuZC52YWx1ZSA9IG1lbWJlclswXS52YWx1ZVxuICAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHRoaXMubWVtYmVycy5wdXNoKC4uLm1lbWJlcilcbiAgIH1cblxuICAgYXN5bmMgYXBwZW5kKG9iajogTW9kZWxDcmVhdGVQYXJhbXMpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIGxldCBtZW1iZXJzID0gTWVtYmVyLmNyZWF0ZShvYmosIHRoaXMubW9kZWwsIHsgbW9kZWw6IHRoaXMubW9kZWwgfSwgdGhpcy5jb250ZXh0KVxuXG4gICAgICBmb3IgKGxldCBtZW1iZXIgb2YgbWVtYmVycykge1xuICAgICAgICAgbGV0IGZvdW5kID0gdGhpcy5tZW1iZXJzLmZpbmQobSA9PiBtLm5hbWUgPT09IG1lbWJlci5uYW1lKVxuXG4gICAgICAgICAvLyBSZXBsYWNlIGFuIGV4aXN0aW5nIE1lbWJlciBpZiB0aGUgVHlwZXMgbWF0Y2hcbiAgICAgICAgIGlmIChmb3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBmb3VuZC52YWx1ZSA9IG1lbWJlci52YWx1ZVxuICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgIH1cblxuICAgICAgICAgdGhpcy5tZW1iZXJzLnB1c2gobWVtYmVyKVxuICAgICAgfVxuICAgfVxuXG4gICBhc3luYyBkZWxldGUobmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICBsZXQgZm91bmQgPSB0aGlzLm1lbWJlcnMuZmluZEluZGV4KG0gPT4gbS5uYW1lID09PSBuYW1lKVxuXG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgIHRoaXMubWVtYmVycy5zcGxpY2UoZm91bmQsIDEpXG4gICAgICB9XG4gICB9XG5cbiAgIGZpbmQocHJlZGljYXRlOiBQcmVkaWNhdGVIYW5kbGVyPElNZW1iZXI+KTogSU1lbWJlciB8IHVuZGVmaW5lZCB7XG4gICAgICByZXR1cm4gdGhpcy5tZW1iZXJzLmZpbmQocHJlZGljYXRlKVxuICAgfVxuXG4gICBtYXA8VD4odmlzaXQ6IFZpc2l0SGFuZGxlcjxJTWVtYmVyLCBUPik6IFRbXSB7XG4gICAgICByZXR1cm4gdGhpcy5tZW1iZXJzLm1hcCh2aXNpdClcbiAgIH1cblxuICAgZ2V0KG5hbWU6IHN0cmluZyk6IElNZW1iZXIgfCB1bmRlZmluZWQge1xuICAgICAgcmV0dXJuIHRoaXMubWVtYmVycy5maW5kKG0gPT4gbS5uYW1lID09PSBuYW1lKVxuICAgfVxufSJdfQ==