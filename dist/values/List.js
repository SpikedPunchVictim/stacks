"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ListValue = exports.ListType = void 0;
const Type_1 = require("./Type");
const Value_1 = require("./Value");
class ListType extends Type_1.Type {
    constructor(itemType) {
        super(Type_1.TypeSet.List);
        this.itemType = itemType;
    }
    equals(other) {
        if (other.type !== Type_1.TypeSet.List) {
            return false;
        }
        let cast = other;
        if (!this.itemType.equals(cast.itemType)) {
            return false;
        }
        return true;
    }
    async validate(obj) {
        if (!Array.isArray(obj)) {
            return { success: false, error: new Error(`Type does not match. Expected 'Array' but receieved '${typeof obj}' instead.`) };
        }
        let array = obj;
        for (let i = 0; i < array.length; ++i) {
            let valid = await this.itemType.validate(array[i]);
            if (valid.success == false) {
                return { success: false, error: new Error(`Encountered an error when validating the items in a List. Reason: ${valid.error}`) };
            }
        }
        return { success: true };
    }
}
exports.ListType = ListType;
class ListValue extends Value_1.Value {
    constructor(itemType) {
        super(new ListType(itemType));
        this.itemType = itemType;
        this.items = new Array();
    }
    [Symbol.iterator]() {
        let index = 0;
        let self = this;
        return {
            next() {
                return index == self.items.length ?
                    { value: undefined, done: true } :
                    { value: self.items[index++], done: false };
            }
        };
    }
    at(index) {
        return this.items.at(index);
    }
    clear() {
        this.items.splice(0, this.items.length);
    }
    equals(other) {
        if (!this.type.equals(other.type)) {
            return false;
        }
        let list = other;
        if (list.items.length != this.items.length) {
            return false;
        }
        for (let i = 0; i < this.items.length; ++i) {
            let thisItem = this.items[i];
            let otherItem = list.items[i];
            if (!thisItem.equals(otherItem)) {
                return false;
            }
        }
        return true;
    }
    push(...items) {
        return this.items.push(...items);
    }
    set(value) {
        if (!this.type.equals(value.type)) {
            throw new Error(`Cannot set a List Value with a different type. Encountered ${value.type.type} when setting the value of a List.`);
        }
        let list = value;
        this.items.splice(0, this.items.length);
        this.items.push(...list.items);
        return this;
    }
    async toJs() {
        let results = new Array();
        for (let i = 0; i < this.items.length; ++i) {
            results.push(await this.items[i].toJs());
        }
        return results;
    }
}
exports.ListValue = ListValue;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGlzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWx1ZXMvTGlzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxpQ0FBNkQ7QUFDN0QsbUNBQXVDO0FBR3ZDLE1BQWEsUUFBUyxTQUFRLFdBQUk7SUFDL0IsWUFBcUIsUUFBZTtRQUNqQyxLQUFLLENBQUMsY0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBREQsYUFBUSxHQUFSLFFBQVEsQ0FBTztJQUVwQyxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQVk7UUFDaEIsSUFBRyxLQUFLLENBQUMsSUFBSSxLQUFLLGNBQU8sQ0FBQyxJQUFJLEVBQUU7WUFDN0IsT0FBTyxLQUFLLENBQUE7U0FDZDtRQUVELElBQUksSUFBSSxHQUFHLEtBQWlCLENBQUE7UUFFNUIsSUFBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUN0QyxPQUFPLEtBQUssQ0FBQTtTQUNkO1FBRUQsT0FBTyxJQUFJLENBQUE7SUFDZCxDQUFDO0lBRUQsS0FBSyxDQUFDLFFBQVEsQ0FBSSxHQUFNO1FBQ3JCLElBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLEtBQUssQ0FBQyx3REFBd0QsT0FBTyxHQUFHLFlBQVksQ0FBQyxFQUFDLENBQUE7U0FDNUg7UUFFRCxJQUFJLEtBQUssR0FBRyxHQUFlLENBQUE7UUFFM0IsS0FBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDbkMsSUFBSSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUVsRCxJ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QyxNQUFNLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDdkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7UUFFOUIsT0FBTyxJQUFJLENBQUE7SUFDZCxDQUFDO0lBRUQsS0FBSyxDQUFDLElBQUk7UUFDUCxJQUFJLE9BQU8sR0FBRyxJQUFJLEtBQUssRUFBTyxDQUFBO1FBRTlCLEtBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtZQUN4QyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1NBQzFDO1FBRUQsT0FBTyxPQUFPLENBQUE7SUFDakIsQ0FBQztDQUNIO0FBNUVELDhCQTRFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElUeXBlLCBUeXBlLCBUeXBlU2V0LCBWYWxpZGF0ZVJlc3VsdCB9IGZyb20gXCIuL1R5cGVcIlxuaW1wb3J0IHsgSVZhbHVlLCBWYWx1ZSB9IGZyb20gXCIuL1ZhbHVlXCJcblxuXG5leHBvcnQgY2xhc3MgTGlzdFR5cGUgZXh0ZW5kcyBUeXBlIHtcbiAgIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGl0ZW1UeXBlOiBJVHlwZSkge1xuICAgICAgc3VwZXIoVHlwZVNldC5MaXN0KVxuICAgfVxuXG4gICBlcXVhbHMob3RoZXI6IElUeXBlKTogYm9vbGVhbiB7XG4gICAgICBpZihvdGhlci50eXBlICE9PSBUeXBlU2V0Lkxpc3QpIHtcbiAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICBsZXQgY2FzdCA9IG90aGVyIGFzIExpc3RUeXBlXG5cbiAgICAgIGlmKCF0aGlzLml0ZW1UeXBlLmVxdWFscyhjYXN0Lml0ZW1UeXBlKSkge1xuICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlXG4gICB9XG5cbiAgIGFzeW5jIHZhbGlkYXRlPFQ+KG9iajogVCk6IFByb21pc2U8VmFsaWRhdGVSZXN1bHQ+IHtcbiAgICAgIGlmKCFBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogbmV3IEVycm9yKGBUeXBlIGRvZXMgbm90IG1hdGNoLiBFeHBlY3RlZCAnQXJyYXknIGJ1dCByZWNlaWV2ZWQgJyR7dHlwZW9mIG9ian0nIGluc3RlYWQuYCl9XG4gICAgICB9XG5cbiAgICAgIGxldCBhcnJheSA9IG9iaiBhcyBBcnJheTxUPlxuXG4gICAgICBmb3IobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgIGxldCB2YWxpZCA9IGF3YWl0IHRoaXMuaXRlbVR5cGUudmFsaWRhdGUoYXJyYXlbaV0pXG5cbiAgICAgICAgIGlmKHZhbGlkLnN1Y2Nlc3MgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogbmV3IEVycm9yKGBFbmNvdW50ZXJlZCBhbiBlcnJvciB3aGVuIHZhbGlkYXRpbmcgdGhlIGl0ZW1zIGluIGEgTGlzdC4gUmVhc29uOiAke3ZhbGlkLmVycm9yfWApfVxuICAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH1cbiAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIExpc3RWYWx1ZSBleHRlbmRzIFZhbHVlIHtcbiAgIHByaXZhdGUgaXRlbXM6IEFycmF5PElWYWx1ZT4gPSBuZXcgQXJyYXk8SVZhbHVlPigpXG4gICBcbiAgIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGl0ZW1UeXBlOiBJVHlwZSkge1xuICAgICAgc3VwZXIobmV3IExpc3RUeXBlKGl0ZW1UeXBlKSlcbiAgIH1cblxuICAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmF0b3I8SVZhbHVlPiB7XG4gICAgICBsZXQgaW5kZXggPSAwXG4gICAgICBsZXQgc2VsZiA9IHRoaXNcbiAgICAgIHJldHVybiB7XG4gICAgICAgICBuZXh0KCk6IEl0ZXJhdG9yUmVzdWx0PElWYWx1ZT4ge1xuICAgICAgICAgICAgcmV0dXJuIGluZGV4ID09IHNlbGYuaXRlbXMubGVuZ3RoID9cbiAgICAgICAgICAgICAgIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9IDpcbiAgICAgICAgICAgICAgIHsgdmFsdWU6IHNlbGYuaXRlbXNbaW5kZXgrK10sIGRvbmU6IGZhbHNlIH1cbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cblxuICAgYXQoaW5kZXg6IG51bWJlcik6IElWYWx1ZSB8IHVuZGVmaW5lZCB7XG4gICAgICByZXR1cm4gdGhpcy5pdGVtcy5hdChpbmRleClcbiAgIH1cblxuICAgY2xlYXIoKTogdm9pZCB7XG4gICAgICB0aGlzLml0ZW1zLnNwbGljZSgwLCB0aGlzLml0ZW1zLmxlbmd0aClcbiAgIH1cblxuICAgZXF1YWxzKG90aGVyOiBJVmFsdWUpOiBib29sZWFuIHtcbiAgICAgIGlmKCF0aGlzLnR5cGUuZXF1YWxzKG90aGVyLnR5cGUpKSB7XG4gICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICAgICAgbGV0IGxpc3QgPSBvdGhlciBhcyBMaXN0VmFsdWVcblxuICAgICAgaWYobGlzdC5pdGVtcy5sZW5ndGggIT0gdGhpcy5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgbGV0IHRoaXNJdGVtID0gdGhpcy5pdGVtc1tpXVxuICAgICAgICAgbGV0IG90aGVySXRlbSA9IGxpc3QuaXRlbXNbaV1cblxuICAgICAgICAgaWYoIXRoaXNJdGVtLmVxdWFscyhvdGhlckl0ZW0pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWUgICAgICBcbiAgIH1cblxuICAgcHVzaCguLi5pdGVtczogSVZhbHVlW10pOiBudW1iZXIge1xuICAgICAgcmV0dXJuIHRoaXMuaXRlbXMucHVzaCguLi5pdGVtcylcbiAgIH1cblxuICAgc2V0KHZhbHVlOiBJVmFsdWUpOiBJVmFsdWUge1xuICAgICAgaWYoIXRoaXMudHlwZS5lcXVhbHModmFsdWUudHlwZSkpIHtcbiAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHNldCBhIExpc3QgVmFsdWUgd2l0aCBhIGRpZmZlcmVudCB0eXBlLiBFbmNvdW50ZXJlZCAke3ZhbHVlLnR5cGUudHlwZX0gd2hlbiBzZXR0aW5nIHRoZSB2YWx1ZSBvZiBhIExpc3QuYClcbiAgICAgIH1cblxuICAgICAgbGV0IGxpc3QgPSB2YWx1ZSBhcyBMaXN0VmFsdWVcblxuICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoMCwgdGhpcy5pdGVtcy5sZW5ndGgpXG4gICAgICB0aGlzLml0ZW1zLnB1c2goLi4ubGlzdC5pdGVtcylcblxuICAgICAgcmV0dXJuIHRoaXNcbiAgIH1cblxuICAgYXN5bmMgdG9KcygpOiBQcm9taXNlPGFueT4ge1xuICAgICAgbGV0IHJlc3VsdHMgPSBuZXcgQXJyYXk8YW55PigpXG5cbiAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLml0ZW1zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICByZXN1bHRzLnB1c2goYXdhaXQgdGhpcy5pdGVtc1tpXS50b0pzKCkpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHRzXG4gICB9XG59Il19