"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Model = void 0;
const MemberCollection_1 = require("./collections/MemberCollection");
const Type_1 = require("./values/Type");
class Model {
    constructor(name, id, context) {
        this.name = name;
        this.id = id;
        this.context = context;
        this.members = new MemberCollection_1.MemberCollection(this, this.context);
        this.symbols = new Array();
    }
    get orchestrator() {
        return this.context.orchestrator;
    }
    get serializer() {
        return this.context.serializer;
    }
    async append(obj) {
        return this.members.append(obj);
    }
    async save(obj) {
        await this.orchestrator.saveObject(this, obj);
    }
    async create(params = {}) {
        return await this.orchestrator.createObject(this, params);
    }
    async delete(object) {
        await this.orchestrator.deleteObject(this, object);
    }
    async get(id) {
        return await this.orchestrator.getObject(this, id);
    }
    async getAll() {
        let cursor = '';
        let results = new Array();
        do {
            let paged = await this.orchestrator.getManyObjects(this, { cursor });
            results.push(...paged.items);
            cursor = paged.cursor;
        } while (cursor !== '');
        return results;
    }
    async getMany(req = {}) {
        return this.orchestrator.getManyObjects(this, req);
    }
    async toJs() {
        let result = {
            id: this.id
        };
        for (let member of this.members) {
            result[member.name] = await this.serializer.toJs(member.value);
        }
        //@ts-ignore
        return result;
    }
    async validate(obj) {
        let report = new Type_1.ValidationReport();
        for (let key of Object.keys(obj)) {
            let member = this.members.get(key);
            if (member === undefined) {
                report.addError(new Error(`Object contains a key that does not exist in the Model: ${key}`));
                continue;
            }
            let result = await member.type.validate(obj[key]);
            if (result.success === false && result.error) {
                report.addError(result.error);
            }
        }
        return report;
    }
}
exports.Model = Model;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvTW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscUVBQXFGO0FBR3JGLHdDQUFpRDtBQW1HakQsTUFBYSxLQUFLO0lBZ0JmLFlBQVksSUFBWSxFQUFFLEVBQVUsRUFBRSxPQUFzQjtRQUN6RCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQTtRQUNoQixJQUFJLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQTtRQUNaLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBRXRCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxtQ0FBZ0IsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQ3ZELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQWUsQ0FBQTtJQUMxQyxDQUFDO0lBbEJELElBQVksWUFBWTtRQUNyQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFBO0lBQ25DLENBQUM7SUFFRCxJQUFZLFVBQVU7UUFDbkIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQTtJQUNqQyxDQUFDO0lBY0QsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFzQjtRQUNoQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ2xDLENBQUM7SUFFRCxLQUFLLENBQUMsSUFBSSxDQUF3QixHQUFNO1FBQ3JDLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUksSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ25ELENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTSxDQUF3QixTQUE2QixFQUFFO1FBQ2hFLE9BQU8sTUFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELEtBQUssQ0FBQyxNQUFNLENBQXdCLE1BQVM7UUFDMUMsTUFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBSSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDeEQsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFHLENBQXdCLEVBQVU7UUFDeEMsT0FBTyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFJLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUN4RCxDQUFDO0lBRUQsS0FBSyxDQUFDLE1BQU07UUFDVCxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUE7UUFDZixJQUFJLE9BQU8sR0FBRyxJQUFJLEtBQUssRUFBSyxDQUFBO1FBRTVCLEdBQUc7WUFDQSxJQUFJLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFJLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUE7WUFDdkUsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUM1QixNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQTtTQUN2QixRQUFPLE1BQU0sS0FBSyxFQUFFLEVBQUM7UUFFdEIsT0FBTyxPQUFPLENBQUE7SUFDakIsQ0FBQztJQUVELEtBQUssQ0FBQyxPQUFPLENBQXdCLE1BQW1CLEVBQUU7UUFDdkQsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBSSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDeEQsQ0FBQztJQUVELEtBQUssQ0FBQyxJQUFJO1FBQ1AsSUFBSSxNQUFNLEdBQUc7WUFDVixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUU7U0FDYixDQUFBO1FBRUQsS0FBSyxJQUFJLE1BQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQzlCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDaEU7UUFFRCxZQUFZO1FBQ1osT0FBTyxNQUFXLENBQUE7SUFDckIsQ0FBQztJQUVELEtBQUssQ0FBQyxRQUFRLENBQUksR0FBTTtRQUNyQixJQUFJLE1BQU0sR0FBRyxJQUFJLHVCQUFnQixFQUFFLENBQUE7UUFFbkMsS0FBSyxJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQy9CLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBRWxDLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtnQkFDdkIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssQ0FBQywyREFBMkQsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFBO2dCQUM1RixTQUFRO2FBQ1Y7WUFFRCxJQUFJLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO1lBRWpELElBQUksTUFBTSxDQUFDLE9BQU8sS0FBSyxLQUFLLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRTtnQkFDM0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDL0I7U0FDSDtRQUVELE9BQU8sTUFBTSxDQUFBO0lBQ2hCLENBQUM7Q0FDSDtBQS9GRCxzQkErRkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJTWVtYmVyQ29sbGVjdGlvbiwgTWVtYmVyQ29sbGVjdGlvbiB9IGZyb20gXCIuL2NvbGxlY3Rpb25zL01lbWJlckNvbGxlY3Rpb25cIjtcbmltcG9ydCB7IElPcmNoZXN0cmF0b3IgfSBmcm9tIFwiLi9vcmNoZXN0cmF0b3IvT3JjaGVzdHJhdG9yXCI7XG5pbXBvcnQgeyBJU3RhY2tDb250ZXh0IH0gZnJvbSBcIi4vc3RhY2svU3RhY2tDb250ZXh0XCI7XG5pbXBvcnQgeyBWYWxpZGF0aW9uUmVwb3J0IH0gZnJvbSBcIi4vdmFsdWVzL1R5cGVcIjtcbmltcG9ydCB7IENyZWF0ZVZhbHVlSGFuZGxlciwgVmFsdWVDcmVhdGVQYXJhbXMgfSBmcm9tIFwiLi92YWx1ZXMvVmFsdWVTb3VyY2VcIjtcbmltcG9ydCB7IFN0YWNrT2JqZWN0IH0gZnJvbSBcIi4vU3RhY2tPYmplY3RcIjtcbmltcG9ydCB7IElWYWx1ZVNlcmlhbGl6ZXIgfSBmcm9tIFwiLi9zZXJpYWxpemUvVmFsdWVTZXJpYWxpemVyXCI7XG5pbXBvcnQgeyBNZW1iZXJJbmZvIH0gZnJvbSBcIi4vTWVtYmVyXCI7XG5cbi8qKlxuICogVGhlIHBhcmFtZXRlcnMgdXNlZCB0byBjcmVhdGUgYW4gT2JqZWN0IGJhc2VkIG9uIGEgTW9kZWwuXG4gKiBUaGUgYWRkaXRpb25hbCBPYmplY3RDcmVhdGVQYXJhbXMgb24gdGhlIHR5cGUgc3VwcG9ydHMgbmVzdGVkXG4gKiB2YWx1ZXMuXG4gKi9cbmV4cG9ydCB0eXBlIE9iamVjdENyZWF0ZVBhcmFtcyA9IHtcbiAgIFtrZXk6IHN0cmluZ106IFZhbHVlQ3JlYXRlUGFyYW1zIHwgT2JqZWN0Q3JlYXRlUGFyYW1zXG59XG5cbmV4cG9ydCB0eXBlIE1vZGVsQ3JlYXRlUGFyYW1zID0ge1xuICAgW2tleTogc3RyaW5nXTogc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IGFueVtdIHwgQ3JlYXRlVmFsdWVIYW5kbGVyIHwgTWVtYmVySW5mb1xufVxuXG5leHBvcnQgdHlwZSBTeW1ib2xFbnRyeSA9IHtcbiAgIG5hbWU6IHN0cmluZyxcbiAgIHZhbHVlOiBhbnlcbn1cblxuZXhwb3J0IHR5cGUgUGFnZVJlc3BvbnNlPFQ+ID0ge1xuICAgY3Vyc29yOiBzdHJpbmdcbiAgIGl0ZW1zOiBUW11cbn1cblxuZXhwb3J0IHR5cGUgUGFnZVJlcXVlc3QgPSB7XG4gICBjdXJzb3I/OiBzdHJpbmdcbiAgIGxpbWl0PzogbnVtYmVyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU1vZGVsIHtcbiAgIHJlYWRvbmx5IGlkOiBzdHJpbmdcbiAgIHJlYWRvbmx5IG5hbWU6IHN0cmluZ1xuXG4gICByZWFkb25seSBtZW1iZXJzOiBJTWVtYmVyQ29sbGVjdGlvblxuICAgcmVhZG9ubHkgc3ltYm9sczogU3ltYm9sRW50cnlbXVxuXG4gICAvKipcbiAgICAqIEFwcGVuZHMgYWRkaXRpb25hbCBNZW1iZXJzIHRvIHRoZSBNb2RlbFxuICAgICogXG4gICAgKiBAcGFyYW0gb2JqIFRoZSBhZGRpdGlvbmFsIG1lbWJlcnMgdG8gYWRkXG4gICAgKi9cbiAgIGFwcGVuZChvYmo6IE1vZGVsQ3JlYXRlUGFyYW1zKTogUHJvbWlzZTx2b2lkPlxuXG4gICAvKipcbiAgICAqIFNzdmVzIHRoZSBvYmplY3QgdG8gc3RvcmFnZVxuICAgICogXG4gICAgKiBAcGFyYW0gb2JqZWN0IFRoZSBvYmplY3QgdG8gY29tbWl0XG4gICAgKi9cbiAgIHNhdmU8VCBleHRlbmRzIFN0YWNrT2JqZWN0PihvYmplY3Q6IFQpOiBQcm9taXNlPHZvaWQ+XG5cbiAgIC8qKlxuICAgICogQ3JlYXRlcyBhIG5ldyBPYmplY3QgYmFzZWQgb24gdGhpcyBNb2RlbFxuICAgICovXG4gICBjcmVhdGU8VCBleHRlbmRzIFN0YWNrT2JqZWN0PihvYmo/OiBPYmplY3RDcmVhdGVQYXJhbXMpOiBQcm9taXNlPFQ+XG5cbiAgIC8qKlxuICAgICogRGVsZXRlcyBhbiBvYmplY3QgZGVyaXZlZCBmcm9tIHRoaXMgTW9kZWxcbiAgICAqIFxuICAgICogQHBhcmFtIG9iamVjdCBUaGUgb2JqZWN0IHRvIGRlbGV0ZVxuICAgICovXG4gICBkZWxldGU8VCBleHRlbmRzIFN0YWNrT2JqZWN0PihvYmplY3Q6IFQpOiBQcm9taXNlPHZvaWQ+XG5cbiAgIC8qKlxuICAgICogUmV0cmlldmVzIGFuIGluc3RhbmNlIGJ5IElEXG4gICAgKiBcbiAgICAqIEBwYXJhbSBpZCBUaGUgSUQgb2YgdGhlIGluc3RhbmNlXG4gICAgKi9cbiAgIGdldDxUIGV4dGVuZHMgU3RhY2tPYmplY3Q+KGlkOiBzdHJpbmcpOiBQcm9taXNlPFQgfCB1bmRlZmluZWQ+XG5cbiAgIC8qKlxuICAgICogR2V0cyBhbGwgT2JqZWN0cyBiYXNlZCBvbiBhIE1vZGVsXG4gICAgKi9cbiAgIGdldEFsbDxUIGV4dGVuZHMgU3RhY2tPYmplY3Q+KCk6IFByb21pc2U8VFtdPlxuXG4gICAvKipcbiAgICAqIEdldHMgbWFueSBPYmplY3RzXG4gICAgKiBcbiAgICAqIEBwYXJhbSByZXEgVGhlIFBhZ2VkUmVxdWVzdCBcbiAgICAqL1xuICAgZ2V0TWFueTxUIGV4dGVuZHMgU3RhY2tPYmplY3Q+KHJlcT86IFBhZ2VSZXF1ZXN0KTogUHJvbWlzZTxQYWdlUmVzcG9uc2U8VD4+XG5cbiAgIC8qKlxuICAgICogQ29udmVydHMgdGhlIE1vZGVsIGludG8gYSBKUyBvYmplY3RcbiAgICAqL1xuICAgdG9KczxUPigpOiBQcm9taXNlPFQ+XG5cbiAgIC8qKlxuICAgICogVmFsaWRhdGVzIGFuIE9iamVjdCBhZ2FpbnN0IHRoZSBNb2RlbCdzIHNjaGVtYVxuICAgICogXG4gICAgKiBAcGFyYW0gb2JqIFRoZSBPYmplY3QgdG8gdmFsaWRhdGVcbiAgICAqL1xuICAgdmFsaWRhdGU8VD4ob2JqOiBUKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVwb3J0PlxufVxuXG5leHBvcnQgY2xhc3MgTW9kZWwgaW1wbGVtZW50cyBJTW9kZWwge1xuICAgcmVhZG9ubHkgaWQ6IHN0cmluZ1xuICAgcmVhZG9ubHkgbmFtZTogc3RyaW5nXG4gICByZWFkb25seSBjb250ZXh0OiBJU3RhY2tDb250ZXh0XG5cbiAgIHByaXZhdGUgZ2V0IG9yY2hlc3RyYXRvcigpOiBJT3JjaGVzdHJhdG9yIHtcbiAgICAgIHJldHVybiB0aGlzLmNvbnRleHQub3JjaGVzdHJhdG9yXG4gICB9XG5cbiAgIHByaXZhdGUgZ2V0IHNlcmlhbGl6ZXIoKTogSVZhbHVlU2VyaWFsaXplciB7XG4gICAgICByZXR1cm4gdGhpcy5jb250ZXh0LnNlcmlhbGl6ZXJcbiAgIH0gICBcblxuICAgcmVhZG9ubHkgbWVtYmVyczogSU1lbWJlckNvbGxlY3Rpb25cbiAgIHJlYWRvbmx5IHN5bWJvbHM6IFN5bWJvbEVudHJ5W11cblxuICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBpZDogc3RyaW5nLCBjb250ZXh0OiBJU3RhY2tDb250ZXh0KSB7XG4gICAgICB0aGlzLm5hbWUgPSBuYW1lXG4gICAgICB0aGlzLmlkID0gaWRcbiAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHRcblxuICAgICAgdGhpcy5tZW1iZXJzID0gbmV3IE1lbWJlckNvbGxlY3Rpb24odGhpcywgdGhpcy5jb250ZXh0KVxuICAgICAgdGhpcy5zeW1ib2xzID0gbmV3IEFycmF5PFN5bWJvbEVudHJ5PigpXG4gICB9XG5cbiAgIGFzeW5jIGFwcGVuZChvYmo6IE1vZGVsQ3JlYXRlUGFyYW1zKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICByZXR1cm4gdGhpcy5tZW1iZXJzLmFwcGVuZChvYmopXG4gICB9XG5cbiAgIGFzeW5jIHNhdmU8VCBleHRlbmRzIFN0YWNrT2JqZWN0PihvYmo6IFQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIGF3YWl0IHRoaXMub3JjaGVzdHJhdG9yLnNhdmVPYmplY3Q8VD4odGhpcywgb2JqKVxuICAgfVxuXG4gICBhc3luYyBjcmVhdGU8VCBleHRlbmRzIFN0YWNrT2JqZWN0PihwYXJhbXM6IE9iamVjdENyZWF0ZVBhcmFtcyA9IHt9KTogUHJvbWlzZTxUPiB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5vcmNoZXN0cmF0b3IuY3JlYXRlT2JqZWN0KHRoaXMsIHBhcmFtcylcbiAgIH1cblxuICAgYXN5bmMgZGVsZXRlPFQgZXh0ZW5kcyBTdGFja09iamVjdD4ob2JqZWN0OiBUKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICBhd2FpdCB0aGlzLm9yY2hlc3RyYXRvci5kZWxldGVPYmplY3Q8VD4odGhpcywgb2JqZWN0KVxuICAgfVxuXG4gICBhc3luYyBnZXQ8VCBleHRlbmRzIFN0YWNrT2JqZWN0PihpZDogc3RyaW5nKTogUHJvbWlzZTxUIHwgdW5kZWZpbmVkPiB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5vcmNoZXN0cmF0b3IuZ2V0T2JqZWN0PFQ+KHRoaXMsIGlkKVxuICAgfVxuXG4gICBhc3luYyBnZXRBbGw8VCBleHRlbmRzIFN0YWNrT2JqZWN0PigpOiBQcm9taXNlPFRbXT4ge1xuICAgICAgbGV0IGN1cnNvciA9ICcnXG4gICAgICBsZXQgcmVzdWx0cyA9IG5ldyBBcnJheTxUPigpXG4gICAgICBcbiAgICAgIGRvIHtcbiAgICAgICAgIGxldCBwYWdlZCA9IGF3YWl0IHRoaXMub3JjaGVzdHJhdG9yLmdldE1hbnlPYmplY3RzPFQ+KHRoaXMsIHsgY3Vyc29yIH0pXG4gICAgICAgICByZXN1bHRzLnB1c2goLi4ucGFnZWQuaXRlbXMpXG4gICAgICAgICBjdXJzb3IgPSBwYWdlZC5jdXJzb3JcbiAgICAgIH0gd2hpbGUoY3Vyc29yICE9PSAnJylcblxuICAgICAgcmV0dXJuIHJlc3VsdHNcbiAgIH1cblxuICAgYXN5bmMgZ2V0TWFueTxUIGV4dGVuZHMgU3RhY2tPYmplY3Q+KHJlcTogUGFnZVJlcXVlc3QgPSB7fSk6IFByb21pc2U8UGFnZVJlc3BvbnNlPFQ+PiB7XG4gICAgICByZXR1cm4gdGhpcy5vcmNoZXN0cmF0b3IuZ2V0TWFueU9iamVjdHM8VD4odGhpcywgcmVxKVxuICAgfVxuXG4gICBhc3luYyB0b0pzPFQ+KCk6IFByb21pc2U8VD4ge1xuICAgICAgbGV0IHJlc3VsdCA9IHtcbiAgICAgICAgIGlkOiB0aGlzLmlkXG4gICAgICB9XG5cbiAgICAgIGZvciAobGV0IG1lbWJlciBvZiB0aGlzLm1lbWJlcnMpIHtcbiAgICAgICAgIHJlc3VsdFttZW1iZXIubmFtZV0gPSBhd2FpdCB0aGlzLnNlcmlhbGl6ZXIudG9KcyhtZW1iZXIudmFsdWUpXG4gICAgICB9XG5cbiAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgcmV0dXJuIHJlc3VsdCBhcyBUXG4gICB9XG5cbiAgIGFzeW5jIHZhbGlkYXRlPFQ+KG9iajogVCk6IFByb21pc2U8VmFsaWRhdGlvblJlcG9ydD4ge1xuICAgICAgbGV0IHJlcG9ydCA9IG5ldyBWYWxpZGF0aW9uUmVwb3J0KClcblxuICAgICAgZm9yIChsZXQga2V5IG9mIE9iamVjdC5rZXlzKG9iaikpIHtcbiAgICAgICAgIGxldCBtZW1iZXIgPSB0aGlzLm1lbWJlcnMuZ2V0KGtleSlcblxuICAgICAgICAgaWYgKG1lbWJlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXBvcnQuYWRkRXJyb3IobmV3IEVycm9yKGBPYmplY3QgY29udGFpbnMgYSBrZXkgdGhhdCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgTW9kZWw6ICR7a2V5fWApKVxuICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgIH1cblxuICAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IG1lbWJlci50eXBlLnZhbGlkYXRlKG9ialtrZXldKVxuXG4gICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgPT09IGZhbHNlICYmIHJlc3VsdC5lcnJvcikge1xuICAgICAgICAgICAgcmVwb3J0LmFkZEVycm9yKHJlc3VsdC5lcnJvcilcbiAgICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlcG9ydFxuICAgfVxufSJdfQ==