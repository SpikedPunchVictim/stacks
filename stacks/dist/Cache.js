"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Cache = void 0;
const UidKeeper_1 = require("./UidKeeper");
class Cache {
    constructor() {
        /**
         * Key: Model name
         * Value: Model
         */
        this.models = new Map();
        /**
         * Key: Model Name
         * Value: Object
         */
        this.objects = new Map();
    }
    deleteModel(name) {
        this.models.delete(name);
    }
    getModel(name) {
        return this.models.get(name);
    }
    getModelById(id) {
        for (let model of this.models.values()) {
            if (model.id === id) {
                return model;
            }
        }
        return undefined;
    }
    hasId(id) {
        let model = this.getModelById(id);
        if (model) {
            return true;
        }
        for (let [_, objects] of this.objects) {
            let found = objects.find(o => o.id === id);
            if (found) {
                return true;
            }
        }
        return false;
    }
    saveModel(model) {
        this.models.set(model.name, model);
    }
    saveObject(model, obj) {
        if (obj.id === UidKeeper_1.UidKeeper.IdNotSet) {
            /*
               Objects must have IDs in order for them to be cached.
               We would have no way to look them up from the cache.
               This means that an Object can be created, before it is
               saved, and the get() calls will not work on them to
               find the Object.
            */
            throw new Error(`Cannot cache an Object without an ID`);
        }
        let objects = this.objects.get(model.name);
        if (objects === undefined) {
            objects = new Array();
            this.objects.set(model.name, objects);
        }
        let found = objects.findIndex(o => o.id === obj.id);
        if (found === -1) {
            objects.push(obj);
            return;
        }
        objects.splice(found, 1);
        objects.push(obj);
    }
    deleteObject(model, obj) {
        let objects = this.objects.get(model.name);
        if (objects === undefined) {
            return;
        }
        let found = objects.findIndex(o => o.id === obj.id);
        if (found === -1) {
            return;
        }
        objects.splice(found, 1);
    }
    getObject(model, id) {
        let objects = this.objects.get(model.name);
        if (objects === undefined) {
            return undefined;
        }
        return objects.find(o => o.id === id);
    }
    getObjects(model) {
        let objects = this.objects.get(model.name);
        return objects || new Array();
    }
}
exports.Cache = Cache;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FjaGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvQ2FjaGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBRUEsMkNBQXdDO0FBdUV4QyxNQUFhLEtBQUs7SUFhZjtRQVpBOzs7V0FHRztRQUNLLFdBQU0sR0FBd0IsSUFBSSxHQUFHLEVBQWtCLENBQUE7UUFFL0Q7OztXQUdHO1FBQ0ssWUFBTyxHQUF3QixJQUFJLEdBQUcsRUFBaUIsQ0FBQTtJQUkvRCxDQUFDO0lBRUQsV0FBVyxDQUFDLElBQVk7UUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDM0IsQ0FBQztJQUVELFFBQVEsQ0FBQyxJQUFZO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDL0IsQ0FBQztJQUVELFlBQVksQ0FBQyxFQUFVO1FBQ3BCLEtBQUksSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBRTtZQUNwQyxJQUFHLEtBQUssQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFO2dCQUNqQixPQUFPLEtBQUssQ0FBQTthQUNkO1NBQ0g7UUFFRCxPQUFPLFNBQVMsQ0FBQTtJQUNuQixDQUFDO0lBRUQsS0FBSyxDQUFDLEVBQVU7UUFDYixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRWpDLElBQUcsS0FBSyxFQUFFO1lBQ1AsT0FBTyxJQUFJLENBQUE7U0FDYjtRQUVELEtBQUksSUFBSSxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ25DLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFBO1lBRTFDLElBQUcsS0FBSyxFQUFFO2dCQUNQLE9BQU8sSUFBSSxDQUFBO2FBQ2I7U0FDSDtRQUVELE9BQU8sS0FBSyxDQUFBO0lBQ2YsQ0FBQztJQUVELFNBQVMsQ0FBQyxLQUFhO1FBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7SUFDckMsQ0FBQztJQUVELFVBQVUsQ0FBd0IsS0FBYSxFQUFFLEdBQU07UUFDcEQsSUFBRyxHQUFHLENBQUMsRUFBRSxLQUFLLHFCQUFTLENBQUMsUUFBUSxFQUFFO1lBQy9COzs7Ozs7Y0FNRTtZQUNGLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQTtTQUN6RDtRQUVELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUUxQyxJQUFHLE9BQU8sS0FBSyxTQUFTLEVBQUU7WUFDdkIsT0FBTyxHQUFHLElBQUksS0FBSyxFQUFPLENBQUE7WUFDMUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQTtTQUN2QztRQUVELElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUVuRCxJQUFHLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNkLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDakIsT0FBTTtTQUNSO1FBRUQsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDeEIsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUNwQixDQUFDO0lBRUQsWUFBWSxDQUF3QixLQUFhLEVBQUUsR0FBTTtRQUN0RCxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFMUMsSUFBRyxPQUFPLEtBQUssU0FBUyxFQUFFO1lBQ3ZCLE9BQU07U0FDUjtRQUVELElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUVuRCxJQUFHLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNkLE9BQU07U0FDUjtRQUVELE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBQzNCLENBQUM7SUFFRCxTQUFTLENBQXdCLEtBQWEsRUFBRSxFQUFVO1FBQ3ZELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUUxQyxJQUFHLE9BQU8sS0FBSyxTQUFTLEVBQUU7WUFDdkIsT0FBTyxTQUFTLENBQUE7U0FDbEI7UUFFRCxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFBO0lBQ3hDLENBQUM7SUFFRCxVQUFVLENBQXdCLEtBQWE7UUFDNUMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQzFDLE9BQU8sT0FBTyxJQUFJLElBQUksS0FBSyxFQUFLLENBQUE7SUFDbkMsQ0FBQztDQUNIO0FBckhELHNCQXFIQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0YWNrT2JqZWN0IH0gZnJvbSBcIi4vU3RhY2tPYmplY3RcIjtcbmltcG9ydCB7IElNb2RlbCB9IGZyb20gXCIuL01vZGVsXCI7XG5pbXBvcnQgeyBVaWRLZWVwZXIgfSBmcm9tIFwiLi9VaWRLZWVwZXJcIjtcblxuXG5leHBvcnQgaW50ZXJmYWNlIElDYWNoZSB7XG4gICAvKipcbiAgICAqIERlbGV0ZXMgYSBNb2RlbCBmcm9tIHRoZSBjYWNoZVxuICAgICogXG4gICAgKiBAcGFyYW0gbmFtZSBUaGUgTW9kZWwncyBuYW1lXG4gICAgKi9cbiAgIGRlbGV0ZU1vZGVsKG5hbWU6IHN0cmluZyk6IHZvaWRcblxuICAgLyoqXG4gICAgKiBHZXRzIGEgTW9kZWwgYnkgbmFtZVxuICAgICogXG4gICAgKiBAcGFyYW0gbmFtZSBUaGUgTW9kZWwncyBuYW1lXG4gICAgKi9cbiAgIGdldE1vZGVsKG5hbWU6IHN0cmluZyk6IElNb2RlbCB8IHVuZGVmaW5lZFxuXG4gICAvKipcbiAgICAqIEdldHMgYSBNb2RlbCBieSBJRFxuICAgICogXG4gICAgKiBAcGFyYW0gaWQgVGhlIE1vZGVsJ3MgSURcbiAgICAqL1xuICAgZ2V0TW9kZWxCeUlkKGlkOiBzdHJpbmcpOiBJTW9kZWwgfCB1bmRlZmluZWRcblxuICAgLyoqXG4gICAgKiBTZWFyY2hlcyB0aGUgQ2FjaGUgZm9yIGFuIElEXG4gICAgKiBcbiAgICAqIEBwYXJhbSBpZCBUaGUgSUQgdG8gc2VhcmNoIGZvclxuICAgICovXG4gICBoYXNJZChpZDogc3RyaW5nKTogYm9vbGVhblxuXG4gICAvKipcbiAgICAqIFN0b3JlcyBhIE1vZGVsIGluIHRoZSBjYWNoZVxuICAgICogXG4gICAgKiBAcGFyYW0gbW9kZWwgVGhlIE1vZGVsIHRvIHN0b3JlXG4gICAgKi9cbiAgIHNhdmVNb2RlbChtb2RlbDogSU1vZGVsKTogdm9pZFxuXG4gICAvKipcbiAgICAqIFN0b3JlcyBhbiBPYmplY3QgaW4gdGhlIGNhY2hlXG4gICAgKiBcbiAgICAqIEBwYXJhbSBtb2RlbCBUaGUgT2JqZWN0J3MgTW9kZWxcbiAgICAqIEBwYXJhbSBvYmogVGhlIE9iamVjdCB0byBTdG9yZS4gVGhpcyBpcyBhbiBQcm94eU9iamVjdFxuICAgICovXG4gICBzYXZlT2JqZWN0PFQgZXh0ZW5kcyBTdGFja09iamVjdD4obW9kZWw6IElNb2RlbCwgb2JqOiBUKTogdm9pZFxuXG4gICAvKipcbiAgICAqIERlbGV0ZXMgYW4gT2JqZWN0IGZyb20gdGhlIGNhY2hlXG4gICAgKiBcbiAgICAqIEBwYXJhbSBtb2RlbCBUaGUgT2JqZWN0J3MgTW9kZWxcbiAgICAqIEBwYXJhbSBvYmogVGhlIE9iamVjdCB0byBkZWxldGVcbiAgICAqL1xuICAgZGVsZXRlT2JqZWN0PFQgZXh0ZW5kcyBTdGFja09iamVjdD4obW9kZWw6IElNb2RlbCwgb2JqOiBUKTogdm9pZFxuXG4gICAvKipcbiAgICAqIEdldHMgYW4gT2JqZWN0IChQcm94eU9iamVjdCkgZnJvbSB0aGUgQ2FjaGVcbiAgICAqIFxuICAgICogQHBhcmFtIG1vZGVsIFRoZSBPYmplY3QncyBNb2RlbFxuICAgICogQHBhcmFtIGlkIFRoZSBPYmplY3QncyBJRFxuICAgICovXG4gICBnZXRPYmplY3Q8VCBleHRlbmRzIFN0YWNrT2JqZWN0Pihtb2RlbDogSU1vZGVsLCBpZDogc3RyaW5nKTogVCB8IHVuZGVmaW5lZFxuXG4gICAvKipcbiAgICAqIEdldHMgbWFueSBPYmplY3RzIChQcm94eU9iamVjdHMpIGZyb20gdGhlIGNhY2hlIGJhc2VkIG9uIHRoZSBNb2RlbFxuICAgICogXG4gICAgKiBAcGFyYW0gbW9kZWwgVGhlIE1vZGVsIG9mIHRoZSBPYmplY3RzXG4gICAgKi9cbiAgIGdldE9iamVjdHM8VCBleHRlbmRzIFN0YWNrT2JqZWN0Pihtb2RlbDogSU1vZGVsKTogVFtdXG59XG5cbmV4cG9ydCBjbGFzcyBDYWNoZSBpbXBsZW1lbnRzIElDYWNoZSB7XG4gICAvKipcbiAgICAqIEtleTogTW9kZWwgbmFtZVxuICAgICogVmFsdWU6IE1vZGVsXG4gICAgKi9cbiAgIHByaXZhdGUgbW9kZWxzOiBNYXA8c3RyaW5nLCBJTW9kZWw+ID0gbmV3IE1hcDxzdHJpbmcsIElNb2RlbD4oKVxuXG4gICAvKipcbiAgICAqIEtleTogTW9kZWwgTmFtZVxuICAgICogVmFsdWU6IE9iamVjdFxuICAgICovXG4gICBwcml2YXRlIG9iamVjdHM6IE1hcDxzdHJpbmcsIGFueVtdPiA9ICBuZXcgTWFwPHN0cmluZywgYW55W10+KClcblxuICAgY29uc3RydWN0b3IoKSB7XG5cbiAgIH1cblxuICAgZGVsZXRlTW9kZWwobmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgICB0aGlzLm1vZGVscy5kZWxldGUobmFtZSlcbiAgIH1cblxuICAgZ2V0TW9kZWwobmFtZTogc3RyaW5nKTogSU1vZGVsIHwgdW5kZWZpbmVkIHtcbiAgICAgIHJldHVybiB0aGlzLm1vZGVscy5nZXQobmFtZSlcbiAgIH1cblxuICAgZ2V0TW9kZWxCeUlkKGlkOiBzdHJpbmcpOiBJTW9kZWwgfCB1bmRlZmluZWQge1xuICAgICAgZm9yKGxldCBtb2RlbCBvZiB0aGlzLm1vZGVscy52YWx1ZXMoKSkge1xuICAgICAgICAgaWYobW9kZWwuaWQgPT09IGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kZWxcbiAgICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgfVxuXG4gICBoYXNJZChpZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICBsZXQgbW9kZWwgPSB0aGlzLmdldE1vZGVsQnlJZChpZClcblxuICAgICAgaWYobW9kZWwpIHtcbiAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIGZvcihsZXQgW18sIG9iamVjdHNdIG9mIHRoaXMub2JqZWN0cykge1xuICAgICAgICAgbGV0IGZvdW5kID0gb2JqZWN0cy5maW5kKG8gPT4gby5pZCA9PT0gaWQpXG5cbiAgICAgICAgIGlmKGZvdW5kKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2VcbiAgIH1cblxuICAgc2F2ZU1vZGVsKG1vZGVsOiBJTW9kZWwpOiB2b2lkIHtcbiAgICAgIHRoaXMubW9kZWxzLnNldChtb2RlbC5uYW1lLCBtb2RlbClcbiAgIH1cbiAgIFxuICAgc2F2ZU9iamVjdDxUIGV4dGVuZHMgU3RhY2tPYmplY3Q+KG1vZGVsOiBJTW9kZWwsIG9iajogVCk6IHZvaWQge1xuICAgICAgaWYob2JqLmlkID09PSBVaWRLZWVwZXIuSWROb3RTZXQpIHtcbiAgICAgICAgIC8qXG4gICAgICAgICAgICBPYmplY3RzIG11c3QgaGF2ZSBJRHMgaW4gb3JkZXIgZm9yIHRoZW0gdG8gYmUgY2FjaGVkLlxuICAgICAgICAgICAgV2Ugd291bGQgaGF2ZSBubyB3YXkgdG8gbG9vayB0aGVtIHVwIGZyb20gdGhlIGNhY2hlLlxuICAgICAgICAgICAgVGhpcyBtZWFucyB0aGF0IGFuIE9iamVjdCBjYW4gYmUgY3JlYXRlZCwgYmVmb3JlIGl0IGlzXG4gICAgICAgICAgICBzYXZlZCwgYW5kIHRoZSBnZXQoKSBjYWxscyB3aWxsIG5vdCB3b3JrIG9uIHRoZW0gdG9cbiAgICAgICAgICAgIGZpbmQgdGhlIE9iamVjdC5cbiAgICAgICAgICovXG4gICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjYWNoZSBhbiBPYmplY3Qgd2l0aG91dCBhbiBJRGApXG4gICAgICB9XG5cbiAgICAgIGxldCBvYmplY3RzID0gdGhpcy5vYmplY3RzLmdldChtb2RlbC5uYW1lKVxuXG4gICAgICBpZihvYmplY3RzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgIG9iamVjdHMgPSBuZXcgQXJyYXk8YW55PigpXG4gICAgICAgICB0aGlzLm9iamVjdHMuc2V0KG1vZGVsLm5hbWUsIG9iamVjdHMpXG4gICAgICB9XG5cbiAgICAgIGxldCBmb3VuZCA9IG9iamVjdHMuZmluZEluZGV4KG8gPT4gby5pZCA9PT0gb2JqLmlkKVxuXG4gICAgICBpZihmb3VuZCA9PT0gLTEpIHtcbiAgICAgICAgIG9iamVjdHMucHVzaChvYmopXG4gICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgb2JqZWN0cy5zcGxpY2UoZm91bmQsIDEpXG4gICAgICBvYmplY3RzLnB1c2gob2JqKVxuICAgfVxuXG4gICBkZWxldGVPYmplY3Q8VCBleHRlbmRzIFN0YWNrT2JqZWN0Pihtb2RlbDogSU1vZGVsLCBvYmo6IFQpOiB2b2lkIHtcbiAgICAgIGxldCBvYmplY3RzID0gdGhpcy5vYmplY3RzLmdldChtb2RlbC5uYW1lKVxuXG4gICAgICBpZihvYmplY3RzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBsZXQgZm91bmQgPSBvYmplY3RzLmZpbmRJbmRleChvID0+IG8uaWQgPT09IG9iai5pZClcblxuICAgICAgaWYoZm91bmQgPT09IC0xKSB7XG4gICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgb2JqZWN0cy5zcGxpY2UoZm91bmQsIDEpXG4gICB9XG5cbiAgIGdldE9iamVjdDxUIGV4dGVuZHMgU3RhY2tPYmplY3Q+KG1vZGVsOiBJTW9kZWwsIGlkOiBzdHJpbmcpOiBUIHwgdW5kZWZpbmVkIHtcbiAgICAgIGxldCBvYmplY3RzID0gdGhpcy5vYmplY3RzLmdldChtb2RlbC5uYW1lKVxuXG4gICAgICBpZihvYmplY3RzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9iamVjdHMuZmluZChvID0+IG8uaWQgPT09IGlkKVxuICAgfVxuXG4gICBnZXRPYmplY3RzPFQgZXh0ZW5kcyBTdGFja09iamVjdD4obW9kZWw6IElNb2RlbCk6IFRbXSB7XG4gICAgICBsZXQgb2JqZWN0cyA9IHRoaXMub2JqZWN0cy5nZXQobW9kZWwubmFtZSlcbiAgICAgIHJldHVybiBvYmplY3RzIHx8IG5ldyBBcnJheTxUPigpXG4gICB9XG59Il19