"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MemberCollection = exports.NoOpMemberCollection = void 0;
const Member_1 = require("../Member");
const Model_1 = require("../Model");
class NoOpMemberCollection {
    get length() {
        throw new Error("Method not implemented.");
    }
    constructor() {
        this.model = Model_1.Model.NoOp;
    }
    add(name, value) {
        throw new Error("Method not implemented.");
    }
    append(obj) {
        throw new Error("Method not implemented.");
    }
    delete(name) {
        throw new Error("Method not implemented.");
    }
    find(predicate) {
        throw new Error("Method not implemented.");
    }
    map(visit) {
        throw new Error("Method not implemented.");
    }
    get(name) {
        throw new Error("Method not implemented.");
    }
    [Symbol.iterator]() {
        throw new Error("Method not implemented.");
    }
}
exports.NoOpMemberCollection = NoOpMemberCollection;
class MemberCollection {
    get length() {
        return this.members.length;
    }
    get uid() {
        return this.context.uid;
    }
    constructor(model, context) {
        this.model = model;
        this.context = context;
        this.members = new Array();
    }
    [Symbol.iterator]() {
        let index = 0;
        let self = this;
        return {
            next() {
                return index == self.members.length ?
                    { value: undefined, done: true } :
                    { value: self.members[index++], done: false };
            }
        };
    }
    async add(name, value) {
        let found = this.members.find(m => m.name === name);
        let member = Member_1.Member.create({ [name]: value }, this.model, { model: this.model }, this.context);
        if (found !== undefined) {
            found.value = member[0].value;
            return;
        }
        this.members.push(...member);
    }
    async append(obj) {
        let members = Member_1.Member.create(obj, this.model, { model: this.model }, this.context);
        for (let member of members) {
            let found = this.members.find(m => m.name === member.name);
            // Replace an existing Member if the Types match
            if (found !== undefined) {
                found.value = member.value;
                continue;
            }
            this.members.push(member);
        }
    }
    async delete(name) {
        let found = this.members.findIndex(m => m.name === name);
        if (found) {
            this.members.splice(found, 1);
        }
    }
    find(predicate) {
        return this.members.find(predicate);
    }
    map(visit) {
        return this.members.map(visit);
    }
    get(name) {
        return this.members.find(m => m.name === name);
    }
}
exports.MemberCollection = MemberCollection;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWVtYmVyQ29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb2xsZWN0aW9ucy9NZW1iZXJDb2xsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHNDQUF5RDtBQUN6RCxvQ0FBMkQ7QUEwQjNELE1BQWEsb0JBQW9CO0lBRzlCLElBQUksTUFBTTtRQUNQLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQ7UUFDRyxJQUFJLENBQUMsS0FBSyxHQUFHLGFBQUssQ0FBQyxJQUFJLENBQUE7SUFDMUIsQ0FBQztJQUVELEdBQUcsQ0FBQyxJQUFZLEVBQUUsS0FBa0I7UUFDakMsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDRCxNQUFNLENBQUMsR0FBc0I7UUFDMUIsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDRCxNQUFNLENBQUMsSUFBWTtRQUNoQixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUNELElBQUksQ0FBQyxTQUFvQztRQUN0QyxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUNELEdBQUcsQ0FBSSxLQUErQjtRQUNuQyxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUNELEdBQUcsQ0FBQyxJQUFZO1FBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDRCxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDZCxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUVIO0FBakNELG9EQWlDQztBQUVELE1BQWEsZ0JBQWdCO0lBSTFCLElBQUks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SUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQ2hDLENBQUM7SUFDSixDQUFDO0lBRUQsSUFBSSxDQUFDLFNBQW9DO1FBQ3RDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7SUFDdEMsQ0FBQztJQUVELEdBQUcsQ0FBSSxLQUErQjtRQUNuQyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ2pDLENBQUM7SUFFRCxHQUFHLENBQUMsSUFBWTtRQUNiLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFBO0lBQ2pELENBQUM7Q0FDSDtBQWhGRCw0Q0FnRkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJTWVtYmVyLCBNZW1iZXIsIE1lbWJlclZhbHVlIH0gZnJvbSBcIi4uL01lbWJlclwiO1xuaW1wb3J0IHsgSU1vZGVsLCBNb2RlbCwgTW9kZWxDcmVhdGVQYXJhbXMgfSBmcm9tICcuLi9Nb2RlbCdcbmltcG9ydCB7IElTdGFja0NvbnRleHQgfSBmcm9tIFwiLi4vc3RhY2svU3RhY2tDb250ZXh0XCI7XG5pbXBvcnQgeyBJVWlkS2VlcGVyIH0gZnJvbSBcIi4uL1VpZEtlZXBlclwiO1xuaW1wb3J0IHsgUHJlZGljYXRlSGFuZGxlciwgVmlzaXRIYW5kbGVyIH0gZnJvbSBcIi4vSGFuZGxlcnNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJTWVtYmVyQ29sbGVjdGlvbiB7XG4gICByZWFkb25seSBtb2RlbDogSU1vZGVsXG4gICByZWFkb25seSBsZW5ndGg6IG51bWJlclxuXG4gICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxJTWVtYmVyPlxuXG4gICBhZGQobmFtZTogc3RyaW5nLCB2YWx1ZTogTWVtYmVyVmFsdWUpOiBQcm9taXNlPHZvaWQ+XG4gICBhcHBlbmQob2JqOiBNb2RlbENyZWF0ZVBhcmFtcyk6IFByb21pc2U8dm9pZD5cbiAgIGRlbGV0ZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+XG4gICBmaW5kKHByZWRpY2F0ZTogUHJlZGljYXRlSGFuZGxlcjxJTWVtYmVyPik6IElNZW1iZXIgfCB1bmRlZmluZWRcblxuICAgLyoqXG4gICAgKiBNYXBzIHRoZSBNZW1iZXJzIGludG8gYW5vdGhlciBzdHJ1Y3R1cmVcbiAgICAqIFxuICAgICogQHBhcmFtIHZpc2l0IEhhbmRsZXIgdXNlZCB0byB0cmFuc2Zvcm0gZWFjaCBGaWVsZFxuICAgICovXG4gICBtYXA8VD4odmlzaXQ6IFZpc2l0SGFuZGxlcjxJTWVtYmVyLCBUPik6IFRbXVxuXG4gICBnZXQobmFtZTogc3RyaW5nKTogSU1lbWJlciB8IHVuZGVmaW5lZFxufVxuXG5leHBvcnQgY2xhc3MgTm9PcE1lbWJlckNvbGxlY3Rpb24gaW1wbGVtZW50cyBJTWVtYmVyQ29sbGVjdGlvbiB7XG4gICBtb2RlbDogSU1vZGVsO1xuXG4gICBnZXQgbGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgIH1cblxuICAgY29uc3RydWN0b3IoKSB7XG4gICAgICB0aGlzLm1vZGVsID0gTW9kZWwuTm9PcFxuICAgfVxuICAgXG4gICBhZGQobmFtZTogc3RyaW5nLCB2YWx1ZTogTWVtYmVyVmFsdWUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgfVxuICAgYXBwZW5kKG9iajogTW9kZWxDcmVhdGVQYXJhbXMpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgfVxuICAgZGVsZXRlKG5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICB9XG4gICBmaW5kKHByZWRpY2F0ZTogUHJlZGljYXRlSGFuZGxlcjxJTWVtYmVyPik6IElNZW1iZXIgfCB1bmRlZmluZWQge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XG4gICB9XG4gICBtYXA8VD4odmlzaXQ6IFZpc2l0SGFuZGxlcjxJTWVtYmVyLCBUPik6IFRbXSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgIH1cbiAgIGdldChuYW1lOiBzdHJpbmcpOiBJTWVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgfVxuICAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmF0b3I8SU1lbWJlciwgYW55LCB1bmRlZmluZWQ+IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICAgfVxuICAgXG59XG5cbmV4cG9ydCBjbGFzcyBNZW1iZXJDb2xsZWN0aW9uIGltcGxlbWVudHMgSU1lbWJlckNvbGxlY3Rpb24ge1xuICAgcmVhZG9ubHkgbW9kZWw6IElNb2RlbFxuICAgcmVhZG9ubHkgY29udGV4dDogSVN0YWNrQ29udGV4dFxuXG4gICBnZXQgbGVuZ3RoKCk6IG51bWJlciB7XG4gICAgICByZXR1cm4gdGhpcy5tZW1iZXJzLmxlbmd0aFxuICAgfVxuXG4gICBnZXQgdWlkKCk6IElVaWRLZWVwZXIge1xuICAgICAgcmV0dXJuIHRoaXMuY29udGV4dC51aWRcbiAgIH1cblxuICAgcHJpdmF0ZSBtZW1iZXJzOiBJTWVtYmVyW11cblxuICAgY29uc3RydWN0b3IobW9kZWw6IElNb2RlbCwgY29udGV4dDogSVN0YWNrQ29udGV4dCkge1xuICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsXG4gICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0XG4gICAgICB0aGlzLm1lbWJlcnMgPSBuZXcgQXJyYXk8SU1lbWJlcj4oKVxuICAgfVxuXG4gICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxJTWVtYmVyPiB7XG4gICAgICBsZXQgaW5kZXggPSAwXG4gICAgICBsZXQgc2VsZiA9IHRoaXNcbiAgICAgIHJldHVybiB7XG4gICAgICAgICBuZXh0KCk6IEl0ZXJhdG9yUmVzdWx0PElNZW1iZXI+IHtcbiAgICAgICAgICAgIHJldHVybiBpbmRleCA9PSBzZWxmLm1lbWJlcnMubGVuZ3RoID9cbiAgICAgICAgICAgICAgIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9IDpcbiAgICAgICAgICAgICAgIHsgdmFsdWU6IHNlbGYubWVtYmVyc1tpbmRleCsrXSwgZG9uZTogZmFsc2UgfVxuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuXG4gICBhc3luYyBhZGQobmFtZTogc3RyaW5nLCB2YWx1ZTogTWVtYmVyVmFsdWUpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIGxldCBmb3VuZCA9IHRoaXMubWVtYmVycy5maW5kKG0gPT4gbS5uYW1lID09PSBuYW1lKVxuXG4gICAgICBsZXQgbWVtYmVyID0gTWVtYmVyLmNyZWF0ZSh7IFtuYW1lXTogdmFsdWUgfSwgdGhpcy5tb2RlbCwgeyBtb2RlbDogdGhpcy5tb2RlbCB9LCB0aGlzLmNvbnRleHQpXG5cbiAgICAgIGlmIChmb3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICBmb3VuZC52YWx1ZSA9IG1lbWJlclswXS52YWx1ZVxuICAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHRoaXMubWVtYmVycy5wdXNoKC4uLm1lbWJlcilcbiAgIH1cblxuICAgYXN5bmMgYXBwZW5kKG9iajogTW9kZWxDcmVhdGVQYXJhbXMpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIGxldCBtZW1iZXJzID0gTWVtYmVyLmNyZWF0ZShvYmosIHRoaXMubW9kZWwsIHsgbW9kZWw6IHRoaXMubW9kZWwgfSwgdGhpcy5jb250ZXh0KVxuXG4gICAgICBmb3IgKGxldCBtZW1iZXIgb2YgbWVtYmVycykge1xuICAgICAgICAgbGV0IGZvdW5kID0gdGhpcy5tZW1iZXJzLmZpbmQobSA9PiBtLm5hbWUgPT09IG1lbWJlci5uYW1lKVxuXG4gICAgICAgICAvLyBSZXBsYWNlIGFuIGV4aXN0aW5nIE1lbWJlciBpZiB0aGUgVHlwZXMgbWF0Y2hcbiAgICAgICAgIGlmIChmb3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBmb3VuZC52YWx1ZSA9IG1lbWJlci52YWx1ZVxuICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgIH1cblxuICAgICAgICAgdGhpcy5tZW1iZXJzLnB1c2gobWVtYmVyKVxuICAgICAgfVxuICAgfVxuXG4gICBhc3luYyBkZWxldGUobmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICBsZXQgZm91bmQgPSB0aGlzLm1lbWJlcnMuZmluZEluZGV4KG0gPT4gbS5uYW1lID09PSBuYW1lKVxuXG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgIHRoaXMubWVtYmVycy5zcGxpY2UoZm91bmQsIDEpXG4gICAgICB9XG4gICB9XG5cbiAgIGZpbmQocHJlZGljYXRlOiBQcmVkaWNhdGVIYW5kbGVyPElNZW1iZXI+KTogSU1lbWJlciB8IHVuZGVmaW5lZCB7XG4gICAgICByZXR1cm4gdGhpcy5tZW1iZXJzLmZpbmQocHJlZGljYXRlKVxuICAgfVxuXG4gICBtYXA8VD4odmlzaXQ6IFZpc2l0SGFuZGxlcjxJTWVtYmVyLCBUPik6IFRbXSB7XG4gICAgICByZXR1cm4gdGhpcy5tZW1iZXJzLm1hcCh2aXNpdClcbiAgIH1cblxuICAgZ2V0KG5hbWU6IHN0cmluZyk6IElNZW1iZXIgfCB1bmRlZmluZWQge1xuICAgICAgcmV0dXJuIHRoaXMubWVtYmVycy5maW5kKG0gPT4gbS5uYW1lID09PSBuYW1lKVxuICAgfVxufSJdfQ==