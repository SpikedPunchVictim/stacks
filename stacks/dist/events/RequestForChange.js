"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RequestForChange = exports.RequestForChangeSource = void 0;
class RequestForChangeSource {
    constructor(router) {
        this.router = router;
    }
    create(action) {
        return new RequestForChange(action, this.router);
    }
}
exports.RequestForChangeSource = RequestForChangeSource;
class RequestForChange {
    constructor(action, router) {
        this.action = action;
        this.router = router;
        this.fulfills = new Array();
        this.rejects = new Array();
    }
    fulfill(handler) {
        this.fulfills.push(handler);
        return this;
    }
    reject(handler) {
        this.rejects.push(handler);
        return this;
    }
    async commit() {
        try {
            await this.router.raise(this.action);
            for (let handler of this.fulfills) {
                await handler(this.action);
            }
        }
        catch (err) {
            for (let handler of this.rejects) {
                await handler(this.action, err);
            }
        }
    }
}
exports.RequestForChange = RequestForChange;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVxdWVzdEZvckNoYW5nZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ldmVudHMvUmVxdWVzdEZvckNoYW5nZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFTQSxNQUFhLHNCQUFzQjtJQUdoQyxZQUFZLE1BQW9CO1FBQzdCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO0lBQ3ZCLENBQUM7SUFFRCxNQUFNLENBQUMsTUFBYztRQUNsQixPQUFPLElBQUksZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUNuRCxDQUFDO0NBQ0g7QUFWRCx3REFVQztBQVNELE1BQWEsZ0JBQWdCO0lBTTFCLFlBQVksTUFBYyxFQUFFLE1BQW9CO1FBQzdDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxLQUFLLEVBQWMsQ0FBQTtRQUN2QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksS0FBSyxFQUFjLENBQUE7SUFDekMsQ0FBQztJQUVELE9BQU8sQ0FBQyxPQUFtQjtRQUN4QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUMzQixPQUFPLElBQUksQ0FBQTtJQUNkLENBQUM7SUFFRCxNQUFNLENBQUMsT0FBbUI7UUFDdkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDMUIsT0FBTyxJQUFJLENBQUE7SUFDZCxDQUFDO0lBRUQsS0FBSyxDQUFDLE1BQU07UUFDVCxJQUFJLENBQUM7WUFDRixNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUVwQyxLQUFJLElBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDaEMsTUFBTSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBQzdCLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTSxHQUFHLEVBQUUsQ0FBQztZQUNYLEtBQUksSUFBSSxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUMvQixNQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQVksQ0FBQyxDQUFBO1lBQzNDLENBQUM7UUFDSixDQUFDO0lBQ0osQ0FBQztDQUNIO0FBcENELDRDQW9DQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElFdmVudCB9IGZyb20gXCIuL0V2ZW50XCJcbmltcG9ydCB7IElFdmVudFJvdXRlciB9IGZyb20gXCIuL0V2ZW50Um91dGVyXCJcblxuZXhwb3J0IHR5cGUgUmZjSGFuZGxlciA9IChldmVudDogSUV2ZW50LCBlcnI/OiBFcnJvcikgPT4gUHJvbWlzZTx2b2lkPlxuXG5leHBvcnQgaW50ZXJmYWNlIElSZXF1ZXN0Rm9yQ2hhbmdlU291cmNlIHtcbiAgIGNyZWF0ZShhY3Rpb246IElFdmVudCk6IElSZXF1ZXN0Rm9yQ2hhbmdlXG59XG5cbmV4cG9ydCBjbGFzcyBSZXF1ZXN0Rm9yQ2hhbmdlU291cmNlIGltcGxlbWVudHMgSVJlcXVlc3RGb3JDaGFuZ2VTb3VyY2Uge1xuICAgcmVhZG9ubHkgcm91dGVyOiBJRXZlbnRSb3V0ZXJcbiAgIFxuICAgY29uc3RydWN0b3Iocm91dGVyOiBJRXZlbnRSb3V0ZXIpIHtcbiAgICAgIHRoaXMucm91dGVyID0gcm91dGVyXG4gICB9XG5cbiAgIGNyZWF0ZShhY3Rpb246IElFdmVudCk6IElSZXF1ZXN0Rm9yQ2hhbmdlIHtcbiAgICAgIHJldHVybiBuZXcgUmVxdWVzdEZvckNoYW5nZShhY3Rpb24sIHRoaXMucm91dGVyKVxuICAgfVxufVxuXG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJlcXVlc3RGb3JDaGFuZ2Uge1xuICAgY29tbWl0KCk6IFByb21pc2U8dm9pZD5cbiAgIGZ1bGZpbGwoaGFuZGxlcjogUmZjSGFuZGxlcik6IElSZXF1ZXN0Rm9yQ2hhbmdlXG4gICByZWplY3QoaGFuZGxlcjogUmZjSGFuZGxlcik6IElSZXF1ZXN0Rm9yQ2hhbmdlXG59XG5cbmV4cG9ydCBjbGFzcyBSZXF1ZXN0Rm9yQ2hhbmdlIGltcGxlbWVudHMgSVJlcXVlc3RGb3JDaGFuZ2Uge1xuICAgcmVhZG9ubHkgcm91dGVyOiBJRXZlbnRSb3V0ZXJcbiAgIHJlYWRvbmx5IGFjdGlvbjogSUV2ZW50XG4gICBwcml2YXRlIHJlamVjdHM6IEFycmF5PFJmY0hhbmRsZXI+XG4gICBwcml2YXRlIGZ1bGZpbGxzOiBBcnJheTxSZmNIYW5kbGVyPlxuXG4gICBjb25zdHJ1Y3RvcihhY3Rpb246IElFdmVudCwgcm91dGVyOiBJRXZlbnRSb3V0ZXIpIHtcbiAgICAgIHRoaXMuYWN0aW9uID0gYWN0aW9uXG4gICAgICB0aGlzLnJvdXRlciA9IHJvdXRlclxuICAgICAgdGhpcy5mdWxmaWxscyA9IG5ldyBBcnJheTxSZmNIYW5kbGVyPigpXG4gICAgICB0aGlzLnJlamVjdHMgPSBuZXcgQXJyYXk8UmZjSGFuZGxlcj4oKVxuICAgfVxuXG4gICBmdWxmaWxsKGhhbmRsZXI6IFJmY0hhbmRsZXIpOiBJUmVxdWVzdEZvckNoYW5nZSB7XG4gICAgICB0aGlzLmZ1bGZpbGxzLnB1c2goaGFuZGxlcilcbiAgICAgIHJldHVybiB0aGlzXG4gICB9XG4gICBcbiAgIHJlamVjdChoYW5kbGVyOiBSZmNIYW5kbGVyKTogSVJlcXVlc3RGb3JDaGFuZ2Uge1xuICAgICAgdGhpcy5yZWplY3RzLnB1c2goaGFuZGxlcilcbiAgICAgIHJldHVybiB0aGlzXG4gICB9XG5cbiAgIGFzeW5jIGNvbW1pdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgICBhd2FpdCB0aGlzLnJvdXRlci5yYWlzZSh0aGlzLmFjdGlvbilcblxuICAgICAgICAgZm9yKGxldCBoYW5kbGVyIG9mIHRoaXMuZnVsZmlsbHMpIHtcbiAgICAgICAgICAgIGF3YWl0IGhhbmRsZXIodGhpcy5hY3Rpb24pXG4gICAgICAgICB9XG4gICAgICB9IGNhdGNoKGVycikge1xuICAgICAgICAgZm9yKGxldCBoYW5kbGVyIG9mIHRoaXMucmVqZWN0cykge1xuICAgICAgICAgICAgYXdhaXQgaGFuZGxlcih0aGlzLmFjdGlvbiwgZXJyIGFzIEVycm9yKVxuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxufSJdfQ==